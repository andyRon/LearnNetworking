# 《Wireshark网络分析从入门到实践》

任何的网络攻击行为最终都是通过发送数据包来实现的，如果我们从数据包这个层次来分析问题，一切就会清晰起来。

网络故障，网络安全

## 1 走进Wireshark

TcpDump、Sniffer、Ethereal和Wireshark等

Wireshark是一个可以运行在各种主流操作系统上的**数据包分析软件**。

现代网络，”分组交换“（将较大的信息拆分成基本单元），基本单元就是数据包 =包头+包体，包头是源地址和目标地址。

### Wireshark的工作原理

网卡两种工作方式：

普通模式：只会将发给本机的数据包传递给操作系统，其他的一律丢弃。

混杂模式：会将所有通过它的数据包（不管是不是发给本机）都传递给操作系统。Wireshark经常使用混杂模式

Wireshark的工作流程：

1. 捕获：Wireshark将网卡调整为混杂模式，在该模式下捕获网络中传输的二进制数据。
2. 转换：Wireshark将捕获到的二进制数据转换为我们容易理解的形式，同时也会将捕获到的数据包按照顺序进行组装。
3. 分析：最后Wireshark将会对捕获到的数据包进行分析。这些分析包括识别数据包所使用的协议类型、源地址、目的地址、源端口和目的端口等。Wireshark有时也会根据自带的协议解析器来深入地分析数据包的内容。

### 安装

**ChmodBPF**

### Wireshark的优势

1. 所有主流操作系统都可运行
2. 支持更多的网络协议
3. 极为友好的使用界面
4. 对网络数据实时的显示
5. 开源项目（C语言）

### 一次完整的Wireshark使用过程

1. 选择合适的网卡

Wireshark的启动界面中列出了**当前计算机上所有网卡设备的名称以及流经该网卡的数据包信息**。

2. 开始数据包的捕获

![](images/Untitled.png)

> 4：显示过滤器，它的作用是将捕获的所有流量进行筛选，过滤掉不需要的流量。
5：数据包列表面板；每一行表示一个捕获到的数据包，每一列表示数据包的特定信息，如下
  No：按顺序的唯一标识数据包的序列号。
  Time：捕获数据包时的时间戳。
  Source：捕获数据包的源IP地址。
  Destionation：捕获数据包的目的IP地址。
  Protocol：捕获数据包的协议类型。
  Length：捕获数据包的大小。
  Info：数据包的附加信息。
6：数据包细节面板。
7：数据包字节面板。左侧灰色的第1列表示数据的偏移量。第2列是以十六进制表示的数据包内容，第3列是以ASCII码表示的数据包内容。
> 
3. 过滤无用的数据

**会话统计功能**：将相同的源地址和目的地址（例如192.168.0.1到1.1.1.1）之间的所有数据包看作是一个对话。**统计→会话**

![](images/Untitled%201.png)

- Address A：该次对话的A地址。
- Address B：该次对话的B地址。
- Packets：该对话中的数据包数量。
- Bytes：该对话中产生全部数据包的大小。
- Packets A→B：从A地址发往B地址数据包的数量。
- Bytes A→B：从A地址发往B地址数据包的大小之和。
- Packets B→A：从B地址发往A地址数据包的数量。
- Bytes B→A：从B地址发往A地址数据包的大小之和。
- Rel Start：这个值表示的是从Wireshark开始捕获数据包到对话建立之间的时间间隔。
- Duration：这个对话建立的时间。
- Bits/s A→B：这个对话从A到B每秒钟平均网络流量。
- Bits/s B→A：这个对话从B到A每秒钟平均网络流量。

**名字解析**：把IP地址解析为域名（一般在数据捕获结束后启用，减轻捕获时的压力）。**“视图”→“解析名称”→“解析网络地址”。**此时在数据包列表面板会显示域名，在会话列表左下角勾选**解析名称**也可以看到域名。

**过滤功能**

![](images/Untitled%202.png)

![](images/Untitled%203.png)

4. 将捕获到的数据包保存到文件

**“文件”→“导出特定分组”**

![](images/Untitled%204.png)

## 2 过滤无用的数据包